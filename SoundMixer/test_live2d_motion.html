<!DOCTYPE html>
<html>
<head>
    <title>Live2D ëª¨ì…˜ í…ŒìŠ¤íŠ¸</title>
    <meta charset="UTF-8">
    <!-- PixiJS v7 -->
    <script src="https://cdn.jsdelivr.net/npm/pixi.js@7.x/dist/pixi.min.js"></script>
    <!-- Cubism 4 Core -->
    <script src="https://cubism.live2d.com/sdk-web/cubismcore/live2dcubismcore.min.js"></script>
    <!-- pixi-live2d-display with LipSync (ê²Œì„ê³¼ ë™ì¼) -->
    <script src="https://cdn.jsdelivr.net/npm/pixi-live2d-display-lipsyncpatch/dist/cubism4.min.js"></script>
    <style>
        body { margin: 0; padding: 20px; background: #222; color: #fff; font-family: monospace; }
        canvas { border: 2px solid #0f0; }
        #controls { margin-top: 10px; }
        button { margin: 5px; padding: 10px 20px; font-size: 14px; }
        #log { 
            margin-top: 20px; 
            background: #000; 
            padding: 10px; 
            height: 300px; 
            overflow-y: scroll;
            border: 1px solid #0f0;
        }
        .log-entry { margin: 2px 0; }
        .log-success { color: #0f0; }
        .log-error { color: #f00; }
        .log-warn { color: #ff0; }
    </style>
</head>
<body>
    <h1>ğŸ­ Live2D ëª¨ì…˜ ì¸ë±ìŠ¤ í…ŒìŠ¤íŠ¸</h1>
    <canvas id="canvas" width="800" height="600"></canvas>
    
    <div id="controls">
        <h3>ëª¨ì…˜ í…ŒìŠ¤íŠ¸:</h3>
        <button onclick="testMotion(0)">0: idle_01</button>
        <button onclick="testMotion(1)">1: idle_02</button>
        <button onclick="testMotion(2)">2: m_09 (Idle)</button>
        <br>
        <button onclick="testMotion(3)">3: m_01 (FlickDown)</button>
        <button onclick="testMotion(4)">4: m_08 (FlickDown)</button>
        <button onclick="testMotion(5)">5: m_02 (FlickLeft)</button>
        <button onclick="testMotion(6)">6: m_03 (FlickRight)</button>
        <br>
        <button onclick="testMotion(7)">7: m_04 (FlickUp)</button>
        <button onclick="testMotion(8)">8: m_06 (FlickUp)</button>
        <button onclick="testMotion(9)">9: m_13 (FlickUp)</button>
        <button onclick="testMotion(10)">10: m_05 (Shake)</button>
        <br>
        <button onclick="testMotion(11)">11: m_07 (Flick3)</button>
        <button onclick="testMotion(12)">12: m_11 (Flick3)</button>
        <button onclick="testMotion(13)">13: m_10 (Tap)</button>
        <button onclick="testMotion(14)">14: m_12 (Tap)</button>
        <button onclick="testMotion(15)">15: m_14 (Tap)</button>
        <br><br>
        <button onclick="testMissSequence()" style="background:#f00;color:#fff;font-weight:bold;">ğŸ”¥ MISS ì—°ì† í…ŒìŠ¤íŠ¸ (3,4,10)</button>
    </div>
    
    <div id="log">
        <div class="log-entry log-success">âœ… ë¡œê·¸ ì‹œì‘...</div>
    </div>

    <script>
        // PixiJSë¥¼ ì „ì—­ìœ¼ë¡œ ì„¤ì •
        window.PIXI = PIXI;
        
        let app, model;
        
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }
        
        async function init() {
            try {
                // Cubism Core í™•ì¸
                if (typeof window.Live2DCubismCore === 'undefined') {
                    log('âŒ Cubism Coreê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!', 'error');
                    return;
                }
                
                log('âœ… Cubism Core ë²„ì „: ' + window.Live2DCubismCore.Version, 'success');
                log('PixiJS ë²„ì „: ' + PIXI.VERSION, 'info');
                
                // pixi-live2d-display í™•ì¸
                if (typeof PIXI.live2d === 'undefined') {
                    log('âŒ pixi-live2d-displayê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!', 'error');
                    return;
                }
                log('âœ… pixi-live2d-display ë¡œë“œë¨', 'success');
                
                log('PixiJS ì•± ìƒì„± ì¤‘...', 'info');
                app = new PIXI.Application({
                    view: document.getElementById('canvas'),
                    width: 800,
                    height: 600,
                    backgroundAlpha: 0,
                    antialias: true,
                    autoStart: true
                });
                
                log('Live2D ëª¨ë¸ ë¡œë“œ ì¤‘...', 'info');
                model = await PIXI.live2d.Live2DModel.from('assets/Live2D/Unity_chan/unitychan.model3.json');
                
                model.anchor.set(0.5, 0.5);
                model.x = 400;
                model.y = 300;
                model.scale.set(0.3);
                
                app.stage.addChild(model);
                
                log('âœ… ëª¨ë¸ ë¡œë“œ ì™„ë£Œ!', 'success');
                
                // ëª¨ì…˜ ë§¤ë‹ˆì € ì •ë³´ ì¶œë ¥
                const motionManager = model.internalModel?.motionManager;
                if (motionManager) {
                    log(`âœ… MotionManager ë°œê²¬`, 'success');
                    
                    if (motionManager.motionGroups) {
                        const groups = Object.keys(motionManager.motionGroups);
                        log(`ëª¨ì…˜ ê·¸ë£¹ ê°œìˆ˜: ${groups.length}`, 'success');
                        log(`ëª¨ì…˜ ê·¸ë£¹: ${groups.join(', ')}`, 'info');
                        
                        // ê° ê·¸ë£¹ì˜ ëª¨ì…˜ ê°œìˆ˜
                        let totalMotions = 0;
                        groups.forEach(group => {
                            const motions = motionManager.motionGroups[group];
                            const count = Array.isArray(motions) ? motions.length : 0;
                            log(`  - ${group}: ${count}ê°œ ëª¨ì…˜`, 'info');
                            totalMotions += count;
                        });
                        log(`ğŸ“Š ì „ì²´ ëª¨ì…˜ ê°œìˆ˜: ${totalMotions}`, 'success');
                    } else {
                        log('âš ï¸ motionGroupsê°€ ì—†ìŠµë‹ˆë‹¤!', 'warn');
                    }
                } else {
                    log('âš ï¸ MotionManagerë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!', 'warn');
                }
                
                // ì´ˆê¸° ëª¨ì…˜
                log('ì´ˆê¸° IDLE ëª¨ì…˜ ì¬ìƒ...', 'info');
                testMotion(0);
                
            } catch (error) {
                log(`âŒ ì´ˆê¸°í™” ì‹¤íŒ¨: ${error.message}`, 'error');
                console.error('ìƒì„¸ ì—ëŸ¬:', error);
            }
        }
        
        function testMotion(index) {
            try {
                log(`ğŸ¬ ëª¨ì…˜ ì¬ìƒ ì‹œë„...`, 'info');
                
                // ëª¨ì…˜ ê·¸ë£¹ ë§¤í•‘ (JSON ìˆœì„œëŒ€ë¡œ)
                const motionGroups = [
                    { group: 'Idle', index: 0, name: 'idle_01' },
                    { group: 'Idle', index: 1, name: 'idle_02' },
                    { group: 'Idle', index: 2, name: 'm_09' },
                    { group: 'FlickDown', index: 0, name: 'm_01' },
                    { group: 'FlickDown', index: 1, name: 'm_08' },
                    { group: 'FlickLeft', index: 0, name: 'm_02' },
                    { group: 'FlickRight', index: 0, name: 'm_03' },
                    { group: 'FlickUp', index: 0, name: 'm_04' },
                    { group: 'FlickUp', index: 1, name: 'm_06' },
                    { group: 'FlickUp', index: 2, name: 'm_13' },
                    { group: 'Shake', index: 0, name: 'm_05' },
                    { group: 'Flick3', index: 0, name: 'm_07' },
                    { group: 'Flick3', index: 1, name: 'm_11' },
                    { group: 'Tap', index: 0, name: 'm_10' },
                    { group: 'Tap', index: 1, name: 'm_12' },
                    { group: 'Tap', index: 2, name: 'm_14' }
                ];
                
                if (index < 0 || index >= motionGroups.length) {
                    log(`âŒ ì˜ëª»ëœ ì¸ë±ìŠ¤: ${index}`, 'error');
                    return;
                }
                
                const motion = motionGroups[index];
                log(`ğŸ“‹ ëª¨ì…˜ ì •ë³´: ${motion.name} (ê·¸ë£¹: ${motion.group}, ì¸ë±ìŠ¤: ${motion.index})`, 'info');
                
                // ê·¸ë£¹ ê¸°ë°˜ ëª¨ì…˜ ì¬ìƒ
                const result = model.motion(motion.group, motion.index);
                log(`âœ… ëª¨ì…˜ ì¬ìƒ ì„±ê³µ! ë°˜í™˜ê°’: ${JSON.stringify(result)}`, 'success');
            } catch (error) {
                log(`âŒ ëª¨ì…˜ ì¬ìƒ ì‹¤íŒ¨: ${error.message}`, 'error');
                console.error(error);
            }
        }
        
        function testMissSequence() {
            const missIndices = [3, 4, 10]; // m_01, m_08, m_05
            let i = 0;
            
            log('ğŸ”¥ MISS ëª¨ì…˜ ì—°ì† í…ŒìŠ¤íŠ¸ ì‹œì‘ (3ì´ˆ ê°„ê²©)', 'warn');
            log('ì¬ìƒ ìˆœì„œ: m_01(FlickDown) â†’ m_08(FlickDown) â†’ m_05(Shake)', 'info');
            
            const interval = setInterval(() => {
                if (i >= missIndices.length) {
                    clearInterval(interval);
                    log('âœ… MISS í…ŒìŠ¤íŠ¸ ì™„ë£Œ!', 'success');
                    return;
                }
                
                testMotion(missIndices[i]);
                i++;
            }, 3000);
        }
        
        init();
    </script>
</body>
</html>
